name: Check for CM and Jira issue IDs provided in PR description

on:
  workflow_call:
    inputs:
      cm_ids:
        required: true
        type: string
      jira_ids:
        required: true
        type: string
      repo_name:
        required: true
        type: string
      
jobs:
  check-merge-ids:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository content
      uses: actions/checkout@v4
      with:
        repository: jgmeet/jira-integration
        path: jira-integration
    
    - name: Getting CM and Jira Issue IDs from PR description
      id: extract_repo_details
      run: |
        echo "cm_ids=${{ inputs.cm_ids }}" >> $GITHUB_ENV
        echo "jira_ids=${{ inputs.jira_ids }}" >> $GITHUB_ENV
        echo "repo_name=${{ inputs.repo_name }}" >> $GITHUB_ENV

    - name: Set up Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: Install dependencies
      run: npm install
      working-directory: ./jira-integration

    - name: Check IDs
      env:
        EMAIL: ${{ secrets.EMAIL }}
        API_TOKEN: ${{ secrets.API_TOKEN }}
        CM_IDS: ${{ env.cm_ids }}
        JIRA_IDS: ${{ env.jira_ids }}
        REPO_NAME: ${{ env.repo_name }}
      run: node checkMergeDescriptionIDs.js
      working-directory: ./jira-integration
